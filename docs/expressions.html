<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Expressions &#8212; QuartzBio  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=12dfc556" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=b3ba4146"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Expression Functions" href="expression_functions.html" />
    <link rel="prev" title="Transforming Datasets" href="transforming_datasets.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="expressions">
<h1>Expressions<a class="headerlink" href="#expressions" title="Permalink to this heading">¶</a></h1>
<section id="expressions-print">
<h2>Expressions Print<a class="headerlink" href="#expressions-print" title="Permalink to this heading">¶</a></h2>
</section>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p>Expressions on the QuartzBio Enterprise Data Platform (EDP) are Python-like formulas that can be used to pull data from datasets, calculate statistics, or run advanced algorithms. They are typically used when transforming datasets but have many other uses such as <code class="docutils literal notranslate"><span class="pre">building</span> <span class="pre">web</span> <span class="pre">application</span> <span class="pre">widgets</span></code>, <code class="docutils literal notranslate"><span class="pre">pulling EDP data</span> <span class="pre">into</span> <span class="pre">Excel</span></code> or <code class="docutils literal notranslate"><span class="pre">Google</span> <span class="pre">Sheets</span></code>, and <code class="docutils literal notranslate"><span class="pre">augmenting</span> <span class="pre">databases</span> <span class="pre">outside EDP</span></code>. Expressions are also referred to as Python “one-liners” but can be used in both the Python and R client libraries for EDP. Expressions may also be evaluated in the EDP UI for data discovery and data transformation.  Expressions are an advanced topic and this article is recommended for users who have reviewed the series of <strong>Quick Start Guides</strong> for programmatic use of the EDP, starting with <a class="reference external" href="https://quartzbio.freshdesk.com/en/support/solutions/articles/73000608178">EDP Programmatic Guide - Access and Search</a>.</p>
</section>
<section id="expression-syntax">
<h2>Expression Syntax<a class="headerlink" href="#expression-syntax" title="Permalink to this heading">¶</a></h2>
<p>Expressions resemble a single line of code in the Python language. Expressions can only be one valid line of code but can contain line breaks for presentation purposes. As a result, they do not support the declaration of variables or classes.</p>
<p>Expressions can use the built-in library of expression functions in EDP. The expression functions library is maintained by QuartzBio staff and users are encouraged to submit suggestions for new functions to be added to the library.</p>
<p>Expressions can be a simple static value, such as a number or string:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Numeric expression</span>
<span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
<span class="c1"># output: 7</span>

<span class="c1"># String expression</span>
<span class="s2">&quot;hello&quot;</span> <span class="o">+</span> <span class="s2">&quot; world&quot;</span>
<span class="c1"># output: &quot;hello world&quot;</span>
</pre></div>
</div>
<section id="context-variables">
<h3>Context Variables<a class="headerlink" href="#context-variables" title="Permalink to this heading">¶</a></h3>
<p>Depending on when an expression is evaluated, it may also include <code class="docutils literal notranslate"><span class="pre">&quot;context</span> <span class="pre">variables&quot;</span></code>. These are variables available to the expression interpreter at run-time (similar to the library of available functions).</p>
<p>For example, expressions can reference context values provided during evaluation or annotation, such as record:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># String expression with context: {&quot;record&quot;: {&quot;a&quot;: &quot;hello&quot;}}</span>
<span class="n">record</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; world&quot;</span>
<span class="c1"># output: &quot;hello world&quot;</span>
</pre></div>
</div>
<p>The following context variables may be referenced:</p>
<ul class="simple">
<li><p>record: An object containing the current dataset record (or “row”) currently being processed. Users can access field values in the record using Python dictionary notation (e.g. record[‘field’]) or by dot notation (e.g. record.field).</p></li>
<li><p>value: The value of the current field before being processed. This can be used as a shortcut for retrieving the current value.</p></li>
<li><p>source_filename: The filename of the file being imported. This is only available for expressions for fields passed into a dataset import with a manifest or object_id. This is useful if metadata is encoded within the filename e.g. sample info or genome build. This value will be None for dataset imports with records (i.e. when no file is provided)..</p></li>
<li><p>source_dataset: the ID of the source dataset. This is the same as the source_id in a dataset migration. This value is always None for dataset imports (since the source is a file or a list of JSON records, not a dataset).</p></li>
<li><p>target_dataset: the ID of the target dataset. This is the same as the target_id in a dataset migration and the dataset_id in a dataset import.</p></li>
</ul>
<p>The following example shows how these variables can be used during annotation (i.e. when importing or migrating datasets), along with a built-in expression function such as “split”:</p>
<p>If the current record is:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;hello&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>The following fields have valid expressions:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="c1"># Replace the value of `message` with &quot;hello world&quot;</span>
    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="s1">&#39;value + &quot;world&quot;&#39;</span><span class="p">,</span>
        <span class="s2">&quot;ordering&quot;</span><span class="p">:</span> <span class="mi">0</span>
    <span class="p">}</span>

    <span class="c1"># Create a new field containing [&quot;hello&quot;, &quot;world&quot;] using the split function</span>
    <span class="s2">&quot;split_message&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="s1">&#39;record.message.split()&#39;</span><span class="p">,</span>
        <span class="s2">&quot;ordering&quot;</span><span class="p">:</span> <span class="mi">1</span>
        <span class="s2">&quot;is_list&quot;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The output would be:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;hello world&quot;</span><span class="p">,</span> <span class="s2">&quot;split_message&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span><span class="p">]}</span>
</pre></div>
</div>
<p>As well as split, users can also use several other built-in Python functions such as <code class="docutils literal notranslate"><span class="pre">len</span></code>, <code class="docutils literal notranslate"><span class="pre">min</span></code>, <code class="docutils literal notranslate"><span class="pre">max</span></code>, <code class="docutils literal notranslate"><span class="pre">sum</span></code>, <code class="docutils literal notranslate"><span class="pre">round</span></code>, <code class="docutils literal notranslate"><span class="pre">range</span></code>, and a wide range of EDP-specific functions to perform analysis on datasets. In addition, users can wrap functions in other functions, and iterate through lists. This makes it possible to construct advanced expressions that pull and manipulate data from one or more datasets:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Numeric expression using built-in functions</span>
<span class="nb">sum</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
<span class="c1"># output: 4950</span>

<span class="c1"># Numeric expression using a built-in EDP function</span>
<span class="n">dataset_field_stats</span><span class="p">(</span><span class="s2">&quot;quartzbio:Public:/ClinVar/5.2.0-20210110/Variants-GRCH37&quot;</span><span class="p">,</span> <span class="s2">&quot;info.ORIGIN&quot;</span><span class="p">)[</span><span class="s2">&quot;avg&quot;</span><span class="p">]</span>
<span class="c1"># output: 0.883874789018</span>
</pre></div>
</div>
</section>
</section>
<section id="data-types-and-lists">
<h2>Data Types and Lists<a class="headerlink" href="#data-types-and-lists" title="Permalink to this heading">¶</a></h2>
<p>Expressions always have a return value. The value’s data type depends on the expression, but can be one of the following:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Data Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">text</span></code></p></td>
<td><p>A valid UTF-8 string of any length.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">blob</span></code></p></td>
<td><p>A valid UTF-8 string of any length (this data type is not indexed for search).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">date</span></code></p></td>
<td><p>A string in ISO 8601 format, for example: <code class="docutils literal notranslate"><span class="pre">&quot;2017-03-29T14:52:01&quot;</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">integer</span></code></p></td>
<td><p>A signed 32-bit integer with a minimum value of -231 and a maximum value of 231-1.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">long</span></code></p></td>
<td><p>A signed 64-bit integer with a minimum value of -263 and a maximum value of 263-1.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">float</span></code></p></td>
<td><p>single-precision 32-bit IEEE 754 floating point.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">double</span></code></p></td>
<td><p>A double-precision 64-bit IEEE 754 floating point.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">boolean</span></code></p></td>
<td><p>Casts the result to a boolean: <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code>. Uses Python’s truth value testing rules.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">object</span></code></p></td>
<td><p>A key/value, JSON-like object, similar to a Python dictionary.</p></td>
</tr>
</tbody>
</table>
<p>Expressions can be set up to return a single value (default) or a list of values. Enabling list mode will cause the expression to always cast the return value as a list, and vice-versa.</p>
<section id="type-casting">
<h3>Type Casting<a class="headerlink" href="#type-casting" title="Permalink to this heading">¶</a></h3>
<p>Each data type “casts” the result of an expression ensuring compatibility with the underlying dataset system. If the result of an expression is incompatible with the data type, an error will be raised for that record.</p>
<p>For return values compatible with the required data type, the final result should be straightforward. It is important to note that expressions make a distinction between null values (i.e. Python <code class="docutils literal notranslate"><span class="pre">None</span></code>), empty strings, and empty lists. The following tables show what to expect when encountering these types of values for different data types:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Expression Result</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>As Value</p></th>
<th class="head"><p>As List</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code></p></td>
<td><p>string/text</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[&quot;&quot;]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">[&quot;&quot;]</span></code></p></td>
<td><p>string/text</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[&quot;&quot;]</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>string/text</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[None]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">[None]</span></code></p></td>
<td><p>string/text</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[None]</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">[]</span></code></p></td>
<td><p>string/text</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code></p></td>
<td><p>integer/float</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[None]</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">[&quot;&quot;]</span></code></p></td>
<td><p>integer/float</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[None]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>integer/float</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[None]</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">[None]</span></code></p></td>
<td><p>integer/float</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[None]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">[]</span></code></p></td>
<td><p>integer/float</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[]</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code></p></td>
<td><p>boolean</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">False</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[False]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">[&quot;&quot;]</span></code></p></td>
<td><p>boolean</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">False</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[False]</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>boolean</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">False</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[False]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">[None]</span></code></p></td>
<td><p>boolean</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[None]</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">[]</span></code></p></td>
<td><p>boolean</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">float(&quot;inf&quot;)</span></code></p></td>
<td><p>float</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Infinity</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[Infinity]</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">float(&quot;-inf)&quot;</span></code></p></td>
<td><p>float</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">-Infinity</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[-Infinity]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">float(&quot;NaN&quot;)</span></code></p></td>
<td><p>float</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[None]</span></code></p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="using-expressions">
<h2>Using Expressions<a class="headerlink" href="#using-expressions" title="Permalink to this heading">¶</a></h2>
<p>Most commonly, expressions are used to <a class="reference external" href="https://quartzbio.github.io/quartzbio-python/creating_and_migrating_datasets.html#modifying-fields">transform datasets</a>.</p>
<p>Dataset imports and migrations are asynchronous tasks that can take time to run. There are two ways to run expressions in real time:</p>
<ul class="simple">
<li><p>Evaluation: run a single expression with custom context values.</p></li>
<li><p>Annotation: run one or more expressions on an arbitrary list of records.</p></li>
</ul>
<section id="evaluate-an-expression">
<h3>Evaluate an Expression<a class="headerlink" href="#evaluate-an-expression" title="Permalink to this heading">¶</a></h3>
<p>The ability to evaluate a single expression is helpful when testing new expressions, or in the context of an application view that needs a very specific piece of information. When evaluating individual expressions using the evaluate endpoint, no context is included by default. Users can provide a custom dictionary of context variables through the data parameter.</p>
<p>In Python:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">quartzbio</span><span class="w"> </span><span class="kn">import</span> <span class="n">Expression</span>

<span class="c1"># Static expression</span>
<span class="n">expr</span> <span class="o">=</span> <span class="n">Expression</span><span class="p">(</span><span class="s1">&#39;&quot;hello&quot; + &quot; &quot; + &quot;world&quot;&#39;</span><span class="p">)</span>
<span class="n">expr</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="n">is_list</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># Response: &#39;hello world&#39;</span>

<span class="c1"># Expression with a context variable &quot;my_field&quot;</span>
<span class="n">expr</span> <span class="o">=</span> <span class="n">Expression</span><span class="p">(</span><span class="s1">&#39;&quot;hello&quot; + &quot; &quot; + my_field&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;my_field&#39;</span><span class="p">:</span> <span class="s1">&#39;world&#39;</span><span class="p">}</span>
<span class="n">expr</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="n">is_list</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># Response: &#39;hello world&#39;</span>
</pre></div>
</div>
</section>
<section id="annotating-records">
<h3>Annotating Records<a class="headerlink" href="#annotating-records" title="Permalink to this heading">¶</a></h3>
<p>Users can annotate a list of records in real time (i.e. without saving them to a dataset) using the <code class="docutils literal notranslate"><span class="pre">annotate</span></code> endpoint. This provides a way to quickly test one or more expressions on a list of records. To annotate an entire dataset, see <a class="reference external" href="https://quartzbio.github.io/quartzbio-python/creating_and_migrating_datasets.html#modifying-fields">Transforming Datasets</a>.</p>
<p>Examples</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">quartzbio</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotator</span>

<span class="c1"># Define a set of records</span>
<span class="n">records</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;gene&#39;</span><span class="p">:</span> <span class="s1">&#39;BRCA1&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;gene&#39;</span><span class="p">:</span> <span class="s1">&#39;BRCA2&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;gene&#39;</span><span class="p">:</span> <span class="s1">&#39;BRAF&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;gene&#39;</span><span class="p">:</span> <span class="s1">&#39;TTN&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;gene&#39;</span><span class="p">:</span> <span class="s1">&#39;TP53&#39;</span><span class="p">}</span>
<span class="p">]</span>

<span class="c1"># Define the fields to annotate</span>
<span class="n">fields</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="c1"># How many times is the gene in ClinVar?</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;clinvar_count&#39;</span><span class="p">,</span>
        <span class="s1">&#39;data_type&#39;</span><span class="p">:</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;expression&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            dataset_count(</span>
<span class="s2">                &quot;quartzbio:Public:/ClinVar/5.2.0-20210110/Variants-GRCH38&quot;,</span>
<span class="s2">                entities=[(&quot;gene&quot;, record.gene)]</span>
<span class="s2">            )</span>
<span class="s2">        &quot;&quot;&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="c1"># What chromosome is the gene on?</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;chromosome&#39;</span><span class="p">,</span>
        <span class="s1">&#39;data_type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
        <span class="s1">&#39;expression&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            dataset_query(</span>
<span class="s2">                &quot;quartzbio:Public:/ClinVar/5.2.0-20210110/Variants-GRCH38&quot;,</span>
<span class="s2">                entities=[(&quot;gene&quot;, record.gene)],</span>
<span class="s2">                filters=[(&quot;variant&quot;, &quot;gene&quot;)]</span>
<span class="s2">            )[0][&quot;genomic_coordinates&quot;][&quot;chromosome&quot;]</span>
<span class="s2">        &quot;&quot;&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="c1"># Set the current date and time.</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;date_evaluated&#39;</span><span class="p">,</span>
        <span class="s1">&#39;data_type&#39;</span><span class="p">:</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span>
        <span class="s1">&#39;expression&#39;</span><span class="p">:</span> <span class="s1">&#39;now()&#39;</span>
    <span class="p">}</span>
<span class="p">]</span>


<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">Annotator</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">records</span><span class="p">):</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="c1"># Response:</span>
<span class="c1"># {</span>
<span class="c1">#   &#39;results&#39;: [</span>
<span class="c1">#       {</span>
<span class="c1">#           &#39;chromosome&#39;: &#39;17&#39;,</span>
<span class="c1">#           &#39;clinvar_count&#39;: 4692,</span>
<span class="c1">#           &#39;date_evaluated&#39;: &#39;2017-03-29T15:32:02&#39;,</span>
<span class="c1">#           &#39;gene&#39;: &#39;BRCA1&#39;</span>
<span class="c1">#       },</span>
<span class="c1">#       ...</span>
<span class="c1">#   ]</span>
<span class="c1"># }</span>
</pre></div>
</div>
</section>
</section>
<section id="expression-functions">
<h2>Expression Functions<a class="headerlink" href="#expression-functions" title="Permalink to this heading">¶</a></h2>
<p>Users are encouraged to review the <a class="reference external" href="https://quartzbio.github.io/quartzbio-python/expression_functions.html">Expression Functions article</a> to access a list of all built-in EDP expression functions along with details about each function.</p>
</section>
<section id="use-cases">
<h2>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">¶</a></h2>
<p>Expressions can be evaluated using the EDP Python and R client libraries, such as when querying and annotating datasets. Expressions can also be used when creating Expression Recipes and Dataset Templates in EDP, which are data management tools designed to facilitate dataset transformation and annotation.</p>
<p><strong>Expression Recipes</strong></p>
<p>Recipes are expressions that are used to add or modify a dataset field and may be accessed from the EDP web interface to insert or modify a column (field) in a dataset. Recipes can also be used to join datasets by adding multiple fields to a dataset from other datasets based on join conditions. Users are recommended to read the <a class="reference external" href="https://quartzbio.github.io/quartzbio-python/expressions.html#use-cases">Recipes</a> documentation for an in-depth review of Recipes.</p>
<p><strong>Dataset Templates</strong></p>
<p>Templates describe how data should be transformed. A template is a collection of fields (columns) that describe the desired format of some input data. Templates are used to import, export, query, or migrate data. Expressions can be used in templates for field normalization and transformation, as well as for adding additional fields and annotations to input data. Users are recommended to read the <a class="reference external" href="https://quartzbio.github.io/quartzbio-python/dataset_templates.html">Dataset Templates</a> documentation for an in-depth review of Templates.</p>
</section>
<section id="api-endpoints">
<h2>API Endpoints<a class="headerlink" href="#api-endpoints" title="Permalink to this heading">¶</a></h2>
<p>There are two endpoints that can be used to run expressions in real-time: annotate and evaluate. Annotate can be used to transform a list of records, and evaluate can be used for running individual expressions. These two endpoints are primarily designed for testing expressions and dataset templates but they can also be used when data outside of datasets need to be processed. To annotate entire datasets or imported files, see <a class="reference external" href="https://quartzbio.github.io/quartzbio-python/transforming_datasets.html#transforming-datasets">Transforming Data</a>. Also, see <a class="reference external" href="https://quartzbio.github.io/quartzbio-python/expression_functions.html">Expression Functions</a> for a list of functions available for use in expressions.</p>
<p>Methods do not accept URL parameters or request bodies unless specified. Please note that if your EDP endpoint is sponsor-cloud.edp.aws.quartz.bio, you would use sponsor-cloud.api.edp.aws.quartz.bio.
For correct work of the API, you need to change <code class="docutils literal notranslate"><span class="pre">&lt;EDP_API_HOST&gt;</span></code> to your current domain, such as my-domain.api.edp.aws.quartz.bio</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>HTTP Request</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Authorization</p></th>
<th class="head"><p>Response</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>annotate</p></td>
<td><p>POST <a class="reference external" href="https:/">https:/</a>/&lt;EDP_API_HOST&gt;/v1/annotate</p></td>
<td><p>Annotate a list of records with expressions.</p></td>
<td><p>This request requires an authorized user.</p></td>
<td><p>The response contains a list of annotated records and an object containing the number of records with errors and the number of fields with errors.</p></td>
</tr>
<tr class="row-odd"><td><p>evaluate</p></td>
<td><p>POST <a class="reference external" href="https:/">https:/</a>/&lt;EDP_API_HOST&gt;/v1/evaluate</p></td>
<td><p>Run a single expression with a custom context.</p></td>
<td><p>This request requires an authorized user.</p></td>
<td><p>The response contains the evaluated expression.</p></td>
</tr>
</tbody>
</table>
<section id="annotate">
<h3>Annotate<a class="headerlink" href="#annotate" title="Permalink to this heading">¶</a></h3>
<p>Run a set of expressions on a list of records in real-time.</p>
<p>Request Body</p>
<p>In the request body, provide the following properties:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Property</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>fields</p></td>
<td><p>DatasetField</p></td>
<td><p>A list of dataset field objects.</p></td>
</tr>
<tr class="row-odd"><td><p>include_errors</p></td>
<td><p>boolean</p></td>
<td><p>If True, a new field (_errors) will be added to each record containing expression evaluation errors (default: True).</p></td>
</tr>
<tr class="row-even"><td><p>records</p></td>
<td><p>objects</p></td>
<td><p>An arbitrary list of records.</p></td>
</tr>
<tr class="row-odd"><td><p>pre_annotation_expression</p></td>
<td><p>string</p></td>
<td><p>An arbitrary expression that will be applied before the annotation, e.g. ‘explode(record, fields=[“mutations”])’</p></td>
</tr>
<tr class="row-even"><td><p>post_annotation_expression</p></td>
<td><p>string</p></td>
<td><p>An arbitrary expression that will be applied after the annotation, e.g. ‘melt(record,fields=[“gene”, “chromosome”])’</p></td>
</tr>
</tbody>
</table>
</section>
<section id="evaluate">
<h3>Evaluate<a class="headerlink" href="#evaluate" title="Permalink to this heading">¶</a></h3>
<p>Evaluate a single expression with a custom context.</p>
<p>Request Body</p>
<p>In the request body, provide the following properties:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Property</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>fields</p></td>
<td><p>object</p></td>
<td><p>An object containing variables referenced in the expression.</p></td>
</tr>
<tr class="row-odd"><td><p>data_type</p></td>
<td><p>string</p></td>
<td><p>A valid data type to cast the result to.</p></td>
</tr>
<tr class="row-even"><td><p>expression</p></td>
<td><p>string</p></td>
<td><p>A valid expression.</p></td>
</tr>
<tr class="row-odd"><td><p>is_list</p></td>
<td><p>boolean</p></td>
<td><p>True if the result should be a list of values (default: False).</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="common-issues">
<h2>Common Issues<a class="headerlink" href="#common-issues" title="Permalink to this heading">¶</a></h2>
<p>Using expressions does require some basic knowledge of Python. Due to the condensed nature of an expression, syntax errors can be hard to spot. Selecting the correct data type can also be confusing at times.</p>
<p><strong>The data type defines the final output of an expression.</strong></p>
<p>One common issue is confusing the data type of a particular function with the final output of an expression. When working with functions, users can look to its documentation to see what it returns. If it returns a list, users should make sure their expression handles that, even if list mode is disabled.</p>
<p><strong>Some data types are incompatible with some functions.</strong></p>
<p>If a function returns a string, but the user has set the expression’s data type to an integer, double, or object, it may not evaluate properly.</p>
<p><strong>When list mode is disabled it will never return a list.</strong></p>
<p>If list mode is disabled but the expression returns a list, only the first value will be returned. Conversely, if list mode is enabled, the value will always be cast to a list.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">QuartzBio</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Authentication</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="authentication.html">Authentication</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Vaults and Files</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="exporting_data.html">Exporting Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="importing_data.html">Importing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="import_parameters.html">Import Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="import_parameters.html#json-jsonl">JSON (JSONL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="vaults_and_objects.html">Vaults and Objects</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Datasets</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="creating_and_migrating_datasets.html">Creating and Migrating Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset_templates.html">Dataset Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset_versioning.html">Dataset Versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="joining_and_aggregating_datasets.html">Joining and Aggregating Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="transforming_datasets.html">Transforming Datasets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Expressions</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Expressions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#expressions-print">Expressions Print</a></li>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#expression-syntax">Expression Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-types-and-lists">Data Types and Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-expressions">Using Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#expression-functions">Expression Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-cases">Use Cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="#api-endpoints">API Endpoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="#common-issues">Common Issues</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="expression_functions.html">Expression Functions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Global Search</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data_discovery.html">Data Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata_and_global_beacons.html">Metadata and Global Beacons</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Queries and Filters</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="filters.html">Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="querying_datasets_and_files.html">Querying Datasets and Files</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Changelog</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="https://pypi.org/project/quartzbio/">Current Version: v1.2.0</a></li>
    
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="transforming_datasets.html" title="previous chapter">Transforming Datasets</a></li>
      <li>Next: <a href="expression_functions.html" title="next chapter">Expression Functions</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025 Precision for Medicine, inc..
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/expressions.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>